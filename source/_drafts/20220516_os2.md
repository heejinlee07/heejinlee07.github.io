---
title: Operating Systems - 컴퓨터 시스템의 동작 원리
date: 2022-05-16
tags:
---

## 컴퓨터 시스템의 구조

컴퓨터의 업무 처리 방식: 컴퓨터 외부 장치에서 컴퓨터 내부로 데이터를 읽어와서 각종 연산을 수행 후, 그 결과를 컴퓨터 외부 장치로 다시 내어 보내는 방식. 컴퓨터 내부로 데이터가 들어오는 것이 입력(input), 외부 장치로 데이터가 나가는 것은 출력(output)이다.

- 입출력 장치: 컴퓨터 외부 장치를 입출력 장치라고도 한다.
- 컨트롤러: 컴퓨터 내의 하드웨어 장치에 존재하는 일종의 작은 CPU
- 커널: 운영 체제 중 항상 메모리에 올라가 있는 부분

## CPU와 I/O 연산

- `CPU`: 컴퓨터 내에서 수행되는 연산을 담당한다. 매시점 메모리에서 명령을 하나씩 읽어와서 수행한다.
  - `인터럽트 라인`: CPU 옆에 있는데, CPU가 자신의 작업을 하던 중 인터럽트 라인에 신호가 들어오면 하던 일을 멈추고 인터럽트와 관련된 일을 처리한다. _작업이 다 끝났는지 어떤지 전달받는 역할을 한다._
- `I/O 연산`: 입출력 장치의 I/O 연산은 I/O 컨트롤러가 담당한다.
  - `컨트롤러`: 입출력 장치와 메인 CPU는 동시 수행이 가능한데, 이를 제어하기 위해 장치 컨트롤러가 있다. 키보드 입력 등의 _이벤트를 CPU에게 알려 줄 필요가 있는 경우 컨트롤러가 발생시킨다._
    - 디스크나 키보드 등의 장치에서 로컬 버퍼로 데이터를 읽어오는 일을 담당한다.
    - 인터럽트를 발생시켜 CPU에 보고하여 데이터를 모두 가지고 왔는지 아닌지를 체크한다.
  - `로컬 버퍼(local buffer)`: 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리. 로컬 버퍼에 임시 저장되어 있던 데이터는 이후 메모리에 전달된다.

---

> 인터럽트: 인터럽트 당한 시점의 레지스터와 Program Counter를 save한 후 CPU의 제어를 인터럽트 처리 루틴에 넘긴다.

## 인터럽트의 일반적인 기능

*일반적으로 인터럽트는 하드웨어가 발생시킨 인터럽트*를 뜻하지만 넓은 의미의 인터럽트는 하드웨어와 소프트웨어 인터럽트 모두를 말한다. 두 가지의 차이점은 일을 수행하는 방식에 있어서 하드웨어 인터럽트는 컨트롤러 등 **하드웨어 장치가 CPU의 인터럽트 라인을 세팅하는 방식**이고, 소프트웨어 인터럽트는 소프트웨어가 그 일을 수행한다.

- 하드웨어 인터럽트: 하드웨어가 발생시킨 인터럽트
- 소프트웨어 인터럽트(Trap)
  - exception: 프로그램이 오류를 범한 경우
  - system call: 프로그램이 커널 함수를 호출한 경우. 운영체제에 정의된 함수를 호출하는 것.

## 인터럽트 핸들링

> 인터럽트가 발생한 경우 처리해야 할 일의 절차

[CPU와 각종 컨트롤 디바이스의 모습](../../computerStructure.png)

## 하드웨어 인터럽트

### 인터럽트 관련 용어

- `인터럽트 처리 루틴(interrupt service routine)`: 인터럽트 핸들러. 커널 내에 존재하는 해당 인터럽트를 처리하는 커널 함수. 다양한 인터럽트들이 각각 처리해야 할 업무들을 정의하고 있다.
- `인터럽트 벡터`: 인터럽트 종류마다 번호가 있고, 그 번호에 따라 처리해야 할 코드의 위치를 포인터로 가리키고 있는 자료 구조. 해당 인터럽트의 처리 루틴 주소를 가지고 있다.
- `Mode bit`: 사용자 프로그램의 잘못된 수행으로 다른 프로그램 및 운영체제에 피해가 가지 않도록 하기 위한 보호장치. Mode bit을 통해 하드웨어적으로 두 가지 모드의 operation 지원

  > `1` 사용자 모드 : 사용자 프로그램 수행
  > `0` 모니터 모드 : OS 코드 수행 (=커널 코드, 시스템 모드)

  - 보안을 해 칠 수 있는 중요한 명령어는 모니터 모드에서만 수행가능한 `특권명령`으로 규정된다.
  - 인터럽트나 exception 발생 시 하드웨어가 Mode bit을 `0`으로 바꾼다.
  - 사용자 프로그램에게 CPU를 넘기기 전에 Mode bit을 `1`로 세팅한다.

- `I/O Device Controller` : 해당 I/O 장치 유형을 관리하는 일종의 작은 CPU.
  - 제어 정보를 위해 control register, status register를 가진다.
  - I/O는 실제 device와 local buffer 사이에서 일어난다.
  - **Device controller는 I/O가 끝났을 경우 인터럽트로 CPU에 그 사실을 알린다.**
- `Device driver (장치구동기)`: OS 코드 중 각 장치병 처리 루틴 -> `software`
- `Device Controller`: 각 장치를 통제하는 일종의 작은 CPU -> `hardware`
- `Timer`: 정해진 시간이 흐른 뒤 운영체제에게 제어권이 넘어가도록 인터럽트를 발생시킨다.
  - 타이머는 매 클릭 틱 때마다 1씩 감소한다.
  - 타이머 값이 0이 되면 타이머 인터럽트가 발생한다.
  - **CPU를 특정 프로그램이 독점하는 것으로부터 보호한다.**
  - Time sharing을 구현하기 위해 널리 이용된다.
  - 현재 시간을 계산하기 위해서도 사용된다.
- `Register`: 메모리보다 더 빠르면서 정보를 저장할 수 있는 공간

### 인터럽트 수행 순서

1. 이벤트가 발생하여 컨트롤러가 인터럽트를 발생시킨다. 예를 들어 *Disk에서 읽어오라.*와 같은 명령을 만나면 CPU가 Disk에 직접 접근하지 않고, OS가 Disk의 Controller에 일을 시키고, 수행한 일은 local buffer에 집어 넣는다. 일이 끝나면 local buffer에 있는 내용을 해당 일을 시킨 프로그램에 copy해준다.
2. CPU는 하던 일을 멈추고, 인터럽트 벡터를 확인하고, 해당 인터럽트가 있는 위치를 찾아간다.
3. 인터럽트 서비스 루틴을 통해 해당하는 인터럽트 처리를 완료한다.
4. 인터럽트의 처리가 완료되었으므로 CPU를 점령당하기 이전의 인터럽트로 돌아가서 하던 작업을 다시 처리한다.

## 소프트웨어 인터럽트

프로세스가 0으로 나누는 연산 등을 시도하거나 프로그램이 수행되다가 접근해서는 안 되는 메모리 영역에 접근하려 할 때 발생한다. 트랩(Trap)라고도 불린다. 하드웨어 인터럽트처럼 컨트롤러가 발생시키는 것이 아니고, **프로그램 수행 도중 직접 CPU에 인터럽트 라인을 세팅하여 발생시킨다.**

---

## 입출력 구조

---

_References_
[운영체제](http://www.kocw.net/home/search/kemView.do?kemId=1046323)
[운영 체제와 정보 기술의 원리] 반효경 지음
